function createInteractivePlots({d3:e,Plotly:t}){async function r(e){try{const t=await fetch(`data/${e}`);if(!t.ok)throw new Error(`Failed to load ${e}`);const r=(await t.text()).trim().split("\n"),n=r[0].split(",");return r.slice(1).map(e=>{const t=e.split(","),r={};return n.forEach((e,n)=>{const a=t[n];r[e]=isNaN(a)?a:parseFloat(a)}),r})}catch(e){return console.error(`Error loading data: ${e}`),[]}}function n(){const e=parseInt(y.property("value"));x.text(`\u03bb = ${_[e]}`)}function a(){const e=parseInt(h.property("value"));b.text(`\u0394 = ${z[e]}`)}function o(){const e=u.property("value");v.style("display","regression"===e?"flex":"none")}async function l(){const e=u.property("value"),n=m.property("value"),a=parseInt(y.property("value")),o=parseInt(h.property("value")),l=_[a],i=z[o];try{let a;if("classification"===e?(a=await r("classification_1d.csv"),a=a.filter(e=>e.nonlinearity===n&&Math.abs(e.lambda-l)<1e-10)):(a=await r("regression_1d.csv"),a=a.filter(e=>e.nonlinearity===n&&Math.abs(e.lambda-l)<1e-10&&Math.abs(e.Delta-i)<1e-10)),0===a.length)return void console.log("No data found for current selection");a.sort((e,t)=>e.p_n-t.p_n);const o={x:a.map(e=>e.p_n),y:a.map(e=>e.gen_error),type:"scatter",mode:"lines+markers",name:"classification"===e?`${n} (\u03bb=${l})`:`${n} (\u03bb=${l}, \u0394=${i})`,line:{width:3},marker:{size:6}},s={title:{text:`${e.charAt(0).toUpperCase()+e.slice(1)} Generalization Error`,font:{size:16}},xaxis:{title:"p/n (features per sample)",titlefont:{size:14}},yaxis:{title:"Generalization Error",titlefont:{size:14}},margin:{l:60,r:50,t:50,b:50},hovermode:"closest",annotations:[]},p=a.filter(e=>e.p_n>=.8&&e.p_n<=1.2);if(p.length>0&&l<=.01){const e=p.reduce((e,t)=>t.gen_error>e.gen_error?t:e);s.annotations.push({x:e.p_n,y:e.gen_error,text:"Double Descent<br>Spike",showarrow:!0,arrowhead:2,arrowsize:1,arrowwidth:2,arrowcolor:"#ff0000",ax:20,ay:-30,font:{color:"#ff0000",size:12}})}const d={responsive:!0,displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","resetScale2d"]};await t.newPlot("plot1d",[o],s,d)}catch(e){console.error("Error in plot1D:",e)}}async function i(){const e=m.property("value"),n=parseInt(y.property("value")),a=_[n];try{const n=(await r("surface_3d.csv")).filter(t=>t.nonlinearity===e&&Math.abs(t.lambda-a)<1e-10);if(0===n.length)return void console.log("No 3D data found for current selection");const o={x:n.map(e=>e.p_n),y:n.map(e=>e.n_d),z:n.map(e=>e.gen_error),type:"scatter3d",mode:"markers",marker:{size:4,color:n.map(e=>e.gen_error),colorscale:"Viridis",showscale:!0,colorbar:{title:"Generalization<br>Error"}},text:n.map(e=>`p/n: ${e.p_n.toFixed(2)}<br>n/d: ${e.n_d.toFixed(2)}<br>Error: ${e.gen_error.toFixed(4)}`),hovertemplate:"%{text}<extra></extra>"},l={scene:{xaxis:{title:"p/n (features per sample)"},yaxis:{title:"n/d (samples per latent dimension)"},zaxis:{title:"Generalization Error"},camera:{eye:{x:1.5,y:1.5,z:1.5}}},title:`3D Surface: ${e} nonlinearity (\u03bb=${a})`,margin:{l:0,r:0,t:50,b:0}},i={responsive:!0,displayModeBar:!0};await t.newPlot("plot3d",[o],l,i)}catch(e){console.error("Error in plot3D:",e)}}async function s(){await l(),await i()}const p=e.create("div").style("width","100%").style("max-width","1200px").style("margin","auto");p.append("h3").text("Interactive Generalization Error Analysis").style("text-align","center").style("margin-bottom","20px");const d=p.append("div").style("background","#f8f9fa").style("padding","15px").style("border-radius","5px").style("margin-bottom","20px").style("display","flex").style("flex-wrap","wrap").style("gap","20px").style("justify-content","center"),c=d.append("div").style("display","flex").style("flex-direction","column").style("align-items","center");c.append("label").text("Regularization \u03bb").style("margin-bottom","5px").style("font-weight","bold");const y=c.append("input").attr("type","range").attr("min",0).attr("max",4).attr("step",1).attr("value",1).style("width","150px"),x=c.append("div").style("margin-top","5px").style("font-size","12px"),f=d.append("div").style("display","flex").style("flex-direction","column").style("align-items","center");f.append("label").text("Nonlinearity").style("margin-bottom","5px").style("font-weight","bold");const m=f.append("select").style("padding","5px");m.selectAll("option").data(["sign","erf"]).enter().append("option").attr("value",e=>e).text(e=>e);const g=d.append("div").style("display","flex").style("flex-direction","column").style("align-items","center");g.append("label").text("Task").style("margin-bottom","5px").style("font-weight","bold");const u=g.append("select").style("padding","5px");u.selectAll("option").data(["classification","regression"]).enter().append("option").attr("value",e=>e).text(e=>e);const v=d.append("div").style("display","flex").style("flex-direction","column").style("align-items","center");v.append("label").text("Noise \u0394").style("margin-bottom","5px").style("font-weight","bold");const h=v.append("input").attr("type","range").attr("min",0).attr("max",3).attr("step",1).attr("value",0).style("width","150px"),b=v.append("div").style("margin-top","5px").style("font-size","12px"),w=p.append("div").style("display","flex").style("flex-direction","column").style("gap","30px");w.append("div").attr("id","plot1d").style("height","400px").style("border","1px solid #ddd").style("border-radius","5px");w.append("div").attr("id","plot3d").style("height","500px").style("border","1px solid #ddd").style("border-radius","5px").append("h4").text("3D Surface: n/d vs p/n vs Generalization Error").style("text-align","center").style("margin","10px 0");const _=[1e-4,.001,.01,.1,1],z=[0,.1,.5,1];y.on("input",function(){n(),s().catch(console.error)}),h.on("input",function(){a(),s().catch(console.error)}),m.on("change",()=>s().catch(console.error)),u.on("change",function(){o(),s().catch(console.error)}),n(),a(),o();const $=p.append("div").style("text-align","center").style("padding","40px").style("color","#666").text("Loading interactive plots...");return setTimeout(()=>{$.remove(),s().catch(e=>{console.error("Error loading plots:",e),p.append("div").style("color","red").style("padding","20px").style("text-align","center").text(`Error loading interactive plots: ${e.message}`)})},500),p.node()}export{createInteractivePlots};