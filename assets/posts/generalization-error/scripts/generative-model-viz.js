function randomGaussian(){let e=0,t=0;for(;0===e;)e=Math.random();for(;0===t;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}function generateData(e=50,t=Math.PI/4){const o=[];for(let t=0;t<e;t++)o.push([randomGaussian(),randomGaussian()]);const a=[Math.cos(t),Math.sin(t)],r=[];for(let e=0;e<3;e++){r[e]=[];for(let t=0;t<2;t++)r[e][t]=2*randomGaussian()}return{cPoints:o,theta:a,F:r}}function applyNonlinearity(e,t){return"identity"===t?e:"tanh"===t?Math.tanh(e):"relu"===t?Math.max(0,e):"sign"===t?Math.sign(e):e}function computeProjections(e,t,o){const{cPoints:a,theta:r,F:n}=e;return a.map(e=>{const a=[n[0][0]*e[0]+n[0][1]*e[1],n[1][0]*e[0]+n[1][1]*e[1],n[2][0]*e[0]+n[2][1]*e[1]].map(e=>applyNonlinearity(e,o)),i=e.length;return{c:e,x:a,y:applyNonlinearity((e[0]*r[0]+e[1]*r[1])/i,t)}})}function generativeModelViz({sigmaType:e="identity",f0Type:t="identity",thetaAngle:o=Math.PI/4,rerollTrigger:a=0,d3:r,Plotly:n}){const i=generateData(50,o),l=computeProjections(i,t,e),{theta:s}=i,d=l.map(e=>e.y),c=r.extent(d),p=(r.scaleSequential(r.interpolateViridis).domain(c),l.map(e=>e.x[2])),h=(r.extent(p)[0],-4),m=[];m.push({x:l.map(e=>e.c[0]),y:l.map(e=>e.c[1]),z:l.map(()=>h),mode:"markers",type:"scatter3d",marker:{size:5,color:l.map(e=>e.y),colorscale:"Cividis",colorbar:{title:"Label",x:1.18},line:{color:"#222",width:.5}},name:"Latent",text:l.map(e=>`Label: ${e.y.toFixed(2)}`),hovertemplate:"%{text}<extra></extra>"}),m.push({x:[0,2*s[0]],y:[0,2*s[1]],z:[h,h],mode:"lines+markers",type:"scatter3d",line:{color:"#0077b6",width:2},marker:{size:[3,8],color:"#0077b6",symbol:["circle","diamond"]},name:"\u03b8",hoverinfo:"skip"}),m.push({x:l.map(e=>e.x[0]),y:l.map(e=>e.x[1]),z:l.map(e=>e.x[2]),mode:"markers",type:"scatter3d",marker:{size:5,color:l.map(e=>e.y),colorscale:"Turbo",opacity:.7,line:{color:"#222",width:.5}},name:"Projected",text:l.map(e=>`Label: ${e.y.toFixed(2)}`),hovertemplate:"%{text}<extra></extra>"});const y=4,f=2,x=[],u=[],g=[];for(let e=0;e<=f;e++)for(let t=0;t<=f;t++)x.push(2*e*y/f-y),u.push(2*t*y/f-y),g.push(0);m.push({x:x,y:u,z:g,mode:"markers",type:"scatter3d",marker:{size:1.5,color:"#eee",opacity:.15},showlegend:!1,hoverinfo:"skip",name:"Latent plane"}),l.forEach(e=>{m.push({x:[e.x[0],e.c[0]],y:[e.x[1],e.c[1]],z:[e.x[2],h],mode:"lines",type:"scatter3d",line:{color:"#888",width:1,dash:"dot"},showlegend:!1,hoverinfo:"skip",opacity:.3})});const b={title:{text:"Generative Model Visualization",font:{size:15,color:"#222"}},scene:{xaxis:{title:"Latent Dim 1",range:[-4,4],showgrid:!1,zeroline:!1,color:"#222",backgroundcolor:"#fff"},yaxis:{title:"Latent Dim 2",range:[-4,4],showgrid:!1,zeroline:!1,color:"#222",backgroundcolor:"#fff"},zaxis:{title:"Projected Dim",range:[-4,4],showgrid:!1,zeroline:!1,color:"#222",backgroundcolor:"#fff"},camera:{eye:{x:1.8,y:1.8,z:1.5}},aspectmode:"cube",bgcolor:"#fff"},width:800,height:600,margin:{l:0,r:0,t:40,b:0},legend:{x:.85,y:.95,bgcolor:"#fff",bordercolor:"#eee",borderwidth:1,font:{size:12,color:"#222"}},hovermode:!1},z=r.create("div").style("width","800px").style("height","600px").style("background","#fff");n.newPlot(z.node(),m,b,{responsive:!0,displayModeBar:!0});const M=r.create("div").style("margin-top","8px").style("padding","6px").style("background","#fff").style("border-radius","3px").style("font-size","13px").style("color","#222");M.append("div").style("font-weight","bold").text("Parameters:"),M.append("div").text(`f\u2080: ${t}, \u03c3: ${e}, \u03b8: ${(180*o/Math.PI).toFixed(1)}\xb0`);const k=r.create("div");return k.node().appendChild(z.node()),k.node().appendChild(M.node()),k.node()}